<!DOCTYPE HTML>
<html>

<head>
	<meta charset="utf-8">
	<link rel="stylesheet" href="/stylesheets/bootstrap.min.css">
	<link rel="stylesheet" href="/stylesheets/custom.css">

</head>

<body>
	<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
		<div class="container-fluid">
			<a class="navbar-brand" href="/">Oversteam</a>
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarColor01"
				aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>

			<div class="collapse navbar-collapse" id="navbarColor01">
				<ul class="navbar-nav me-auto">
					<li class="nav-item">
						<a class="nav-link" href="/">Home
							<span class="visually-hidden">(current)</span>
						</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="/shop">Shop</a>
					</li>
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="true"
							aria-expanded="false">Categories</a>
						<div class="dropdown-menu">
							<a class="dropdown-item" href="#">Sandbox</a>
							<a class="dropdown-item" href="#">Real-time strategy (RTS)</a>
							<a class="dropdown-item" href="#">Shooters (FPS and TPS)</a>
							<a class="dropdown-item" href="#">Multiplayer online battle arena (MOBA)</a>
							<a class="dropdown-item" href="#">Role-playing (RPG, ARPG, and More)</a>
							<a class="dropdown-item" href="#">Simulation and sports</a>
							<a class="dropdown-item" href="#">Puzzlers and party games</a>
							<a class="dropdown-item" href="#">Action-adventure</a>
							<a class="dropdown-item" href="#">Survival and horror</a>
							<a class="dropdown-item" href="#">Platformer</a>
						</div>
					</li>
					<li class="nav-item">
						<a class="nav-link active" href="/profile">Profile</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="/about">About</a>
					</li>
				</ul>
				<div class="d-flex" id="btn">
					<ul class="navbar-nav me-auto" id="btn">
						<li class="nav-item">
							<a class="btn btn-secondary me-sm-2" href="/login">Login</a>
						</li>
						<li class="nav-item">
							<a class="btn btn-secondary" href="/signin">Signin</a>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</nav>

	<div class="container">
		<div class="bs-docs-section clearfix">
			<div class="row">
				<div class="page-header d-flex justify-content-between">
					<h1>Add a Game</h1>
				</div>
				<form id="form">
					<fieldset>
						<div class="alert alert-dismissible alert-danger d-none" id="invalid-input-alert">
							<strong>Oh snap!</strong>
							<p id="error-text"></p>Try to fix it and submit again
						</div>
						<div class="form-group">
							<label for="name" class="form-label mt-4">Name</label>
							<input type="text" class="form-control" id="name" aria-describedby="emailhelp"
								placeholder="Enter the name of the game">
						</div>
						<div class="form-group">
							<label for="description" class="form-label mt-4">description</label>
							<input type="text" class="form-control" id="desc" aria-describedby="emailHelp"
								placeholder="Enter the description of the game">
						</div>
						<div class="form-group">
							<label for="exampleSelect1" class="form-label mt-4">Example select</label>
							<select class="form-select" id="category">
								<option>Sandbox</option>
								<option>Real-time strategy (RTS)</option>
								<option>Shooters (FPS and TPS)</option>
								<option>Multiplayer online battle arena (MOBA)</option>
								<option>Role-playing (RPG, ARPG, and More)</option>
								<option>Simulation and sports</option>
								<option>Puzzlers and party games</option>
								<option>Action-adventure</option>
								<option>Survival and horror</option>
								<option>Platformer</option>
							</select>
						</div>
						<div class="form-group">
							<label for="link" class="form-label mt-4">Link</label>
							<input type="link" class="form-control" id="link" placeholder="Enter the link to the game">
						</div>
					</fieldset>
					<br>
					<button type="submit" class="btn btn-primary">Submit</button>
				</form>
			</div>

			<footer id="footer">
				<div class="row">
					<div class="col-lg-12">
						<ul class="list-unstyled">
							<li class="float-end"><a href="#top">Back to top</a></li>
							<li><a href="https://github.com/Paracetamol56/OverSteam">GitHub</a></li>
							<li><a href="../about/#api">API</a></li>
							<li><a href="../about/#donate">Donate</a></li>
						</ul>
						<p>Made by <a href="https://github.com/Lechiffre4">Lechiffre4</a> and <a
								href="https://github.com/Paracetamol56">Paracetamol56</a>.</p>
						<p>Code released under the <a href="https://github.com/Paracetamol56/OverSteam/blob/main/LICENSE">Apache
								License 2.0</a>.</p>
						<p>Based on <a href="https://getbootstrap.com/" rel="nofollow">Bootstrap</a>. Icons from <a
								href="https://fontawesome.com/" rel="nofollow">Font Awesome</a>. Web fonts from <a
								href="https://fonts.google.com/" rel="nofollow">Google</a>.</p>
					</div>
				</div>
			</footer>
		</div>
		<!-- Optional JavaScript -->
		<script src="/javascripts/jquery.min.js"></script>
		<script src="/javascripts/bootstrap.bundle.min.js"></script>
		<script src="/javascripts/prism.js" data-manual></script>
		<script src="/javascripts/custom.js"></script>

</body>
<script>
	const buttons = document.getElementById('btn');

	if (document.cookie) {
		buttons.innerHTML =
			`<ul class="navbar-nav me-auto">
            <li class="nav-item">
                <a class="btn btn-secondary me-sm-2" href="/login">Disconnect</a>
            </li>
        </ul>
        `;
	};

    const token = document.cookie.split('=')[1];
		console.log(token);
		fetch("http://localhost:3000/api/users/me", {
			method: 'GET',
			headers: {
				'token': token
			}
		})
			.then(function (response) {
				console.log(response);
				return response.json();
			})
			.then(function (data) {
				console.log(data);
				const email = data['email'];
				const username = data['username'];
			


	        var form = document.getElementById('form');
	        form.addEventListener('submit', function (e) {
	        	e.preventDefault();
	        	var name = document.getElementById("name").value
	        	var desc = document.getElementById("desc").value
	        	var link = document.getElementById("link").value
                var author = data['username'];
                var category = document.getElementById("category").value
            
            
            
	        	fetch("http://localhost:3000/api/games/addgame", {
	        		method: 'POST',
	        		headers: {
	        			"Content-Type": "application/json; charset=UTF-8"
	        		},
	        		body: JSON.stringify({
	        			name: name,
	        			description: desc,
	        			link: link,
	        			author: author,
                        category: category
	        		})
	        	})
	        		.then(function (response) {
	        			return response.json()
	        		})
	        		.then(function (data) {
	        			if (data.hasOwnProperty('error')) {
	        				console.log(data.error);
	        				document.getElementById("invalid-input-alert").classList.remove("d-none");
	        				document.getElementById("error-text").innerHTML = data.error;
	        			}
	        			else {
	        				document.getElementById("invalid-input-alert").classList.add("d-none");
	        				console.log(data);
	        				window.location.href = "../shop";
	        			}
	        		})
	            })
            
        });
</script>

</html>